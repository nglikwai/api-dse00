<% layout('layouts/boilerplate')%>

    <style>
        .show-container {
            display: flex;
            flex-wrap: wrap;
        }

        .right-bar {
            width: 50px;
        }
    </style>

    <script>
        document.querySelector('title').innerText = '<%= campground.title %>';
    </script>


    <link rel="stylesheet" href="/stylesheets/show.css">


    <div class="index-loop mb-5 pb-5">
        <div>
            <a onclick="history.back()" class="btn dse00btn">Back</a>


            <div class="mb-3">
                <div class="pt-4 pb-3">
                    <h5 class="card-title m-3">
                        <%= campground.title%>
                    </h5>
                    <p class="card-text m-3 mb-5 mt-5">
                        <%= campground.description%>
                    </p>
                </div>
                <div id="campgroundCarousel" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <% campground.images.forEach((img, i)=> { %>
                            <div class="carousel-item <%= i === 0 ? 'active' : ''%>">
                                <img src="<%= img.url%>" class="d-block w-100" alt="">
                            </div>
                            ƒ
                            <% }) %>
                    </div>
                    <% if(campground.images.length> 1) {%>
                        <a class="carousel-control-prev" href="#campgroundCarousel" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">上</span>
                        </a>
                        <a class="carousel-control-next" href="#campgroundCarousel" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">下</span>
                        </a>
                        <% } %>
                </div>
                <div class="mt-1 mb-1">
                    <span class="muted">
                        <%= campground.createdAt.toLocaleString().substring(0,9) %>
                    </span>

                    <% if (currentUser && currentUser.favour.includes(campground._id)) { %>
                        <form action="/<%= campground._id%>/favour?_method=DELETE" method="POST"
                            style="display:inline;">
                            <button class="btn category2 ml-2" style="border:none">
                                ♥ Like (<%= campground.favour %>)</button>
                        </form>
                        <% } else{%>
                            <form action="/<%= campground._id%>/favour?_method=PUT" method="POST"
                                style="display:inline">
                                <button class="btn category2 ml-2">♡ Like (<%= campground.favour %>)</button>
                            </form>
                            <% } %>

                                <a class="category2 ml-2" href="/search?category=<%= campground.category %>">
                                    <%= campground.category %>
                                </a>

                </div>
                <ul class="list-group list-group-flush">

                    <li id="userbar">樓主 ：
                        <a href="/users/user/<%= campground.author._id %> ">
                            <b>
                                <%= campground.author.username.toUpperCase()%>
                            </b>
                            <% if (campground.author.level==4) { %>
                                <span class="silver"> - Lv
                                    <%=campground.author.grade %>
                                </span>
                                <% }else{ %>
                                    <span <%=campground.author.level>4 ? 'class=gold' : 'class=grade' %>> - Lv
                                        <%=campground.author.grade %>
                                    </span>
                                    <% } %>
                        </a>
                    </li>

                </ul>
                <% if(currentUser) {%>
                    <% if (campground.author.equals(currentUser._id) || currentUser.identity=='admin' ) { %>
                        <div class="mt-3 mb-2">
                            <a class="btn dse00btn" href="/<%=campground._id%>/edit">修改</a>
                            <form class="d-inline" action="/<%=campground._id%>?_method=DELETE" method="POST">
                                <button class="btn dse00btn">刪除</button>
                            </form>
                        </div>
                        <% } %>
                            <% } %>
                                <!-- <div class="card-footer text-muted">
                            2 days ago
                        </div> -->
            </div>
            <div>
                <% if (replyReview) { %>

                    <form action="/reply/<%= replyReview._id %>?post=<%=campground._id%>" method="POST"
                        class="mb-3 validated-form" novalidate>
                        <div class="mb-5 mt-5">

                            <div class="quote"> ➼ Re :
                                <%= replyReview.author.username %> -
                                    <%= replyReview.body %>
                            </div>

                            <textarea class="form-control muted" name="review[reply]" id="body" cols="20" rows="2"
                                required style="width:80%" autofocus> </textarea>

                            <button class="btn dse00btn2 mt-0 mb-5">回覆</button>
                            <% } else{%>
                                <div>
                                    <form action="/<%=campground._id%>/reviews" method="POST"
                                        class="mb-3 validated-form" novalidate>
                                        <div class="mb-5 mt-5">
                                            <label class="form-label  mb-4" for="body">留言文字</label>
                                            <textarea class="form-control" name="review[body]" id="body" cols="30"
                                                rows="3" required></textarea>

                                            <div class="valid-feedback">
                                                Looks good!
                                            </div>

                                            <button class="btn dse00btn">提交</button>
                                            <% } %>
                                        </div>
                                    </form>
                                </div>
                                <div>
                                    <% if (campground.reviews.length==0) { %>
                                        <h4 style="margin-top:60px">未有留言</h4>
                                        <% } else{%>
                                            <h4 style="margin-top:60px">留言</h4>
                                            <% let i=1 %>
                                                <% for(let review of campground.reviews) { %>
                                                    <% i++ %>
                                                        <% if (i%5===0) { %>
                                                            <div class="card pb-2 adsense">
                                                                <script async
                                                                    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6622218753379872"
                                                                    crossorigin="anonymous"></script>
                                                                <ins class="adsbygoogle" style="display:block"
                                                                    data-ad-format="fluid"
                                                                    data-ad-layout-key="-gw-3+1f-3d+2z"
                                                                    data-ad-client="ca-pub-6622218753379872"
                                                                    data-ad-slot="8821319250"></ins>
                                                                <script>
                                                                    (adsbygoogle = window.adsbygoogle || []).push({});
                                                                </script>
                                                            </div>
                                                            <% } %>

                                                                <div>
                                                                    <div id="delete">
                                                                        <% if(currentUser) {%>
                                                                            <% if (review.author.equals(currentUser._id)
                                                                                || currentUser.identity=='admin' ) { %>
                                                                                <div style="float: right">
                                                                                    <form
                                                                                        action="/<%=campground._id%>/reviews/<%=review._id%>?_method=DELETE"
                                                                                        method="POST">
                                                                                        <button
                                                                                            onclick="return confirm('Delete?')"
                                                                                            class="btn dse00btn"
                                                                                            style="border:none">X</button>
                                                                                    </form>
                                                                                </div>
                                                                                <% } %>
                                                                                    <% } %>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <div class="card-body">
                                                                            <div class="mb-1">

                                                                                <a class="review-title"
                                                                                    href="/users/user/<%= review.author._id %> ">
                                                                                    <%=
                                                                                        review.author.username.toUpperCase()%>
                                                                                        <% if (review.author.level==4) {
                                                                                            %>
                                                                                            <span class="silver"> - Lv
                                                                                                <%=review.author.grade
                                                                                                    %>
                                                                                            </span>
                                                                                            <% }else{ %>
                                                                                                <span
                                                                                                    <%=review.author.level>4
                                                                                                    ?
                                                                                                    'class=gold'
                                                                                                    : 'class=grade' %>
                                                                                                    >- Lv <%=
                                                                                                        review.author.grade
                                                                                                        %>
                                                                                                </span>
                                                                                                <%}%>

                                                                                                    <span class="muted">
                                                                                                        <%= review.createdAt.toLocaleString().substring(0,9)
                                                                                                            %>
                                                                                                    </span>
                                                                                </a>
                                                                            </div>
                                                                            <div class="index-loop">
                                                                                <p>
                                                                                    <%= review.body %>
                                                                                </p>
                                                                            </div>
                                                                            <div class="pl-3 pb-4">
                                                                                <% if (review.reply) { %>
                                                                                    <% for( let i=0; i <
                                                                                        review.reply.length; i++ ) { %>
                                                                                        <p class="quote p-0 m-0">
                                                                                            ➼
                                                                                            <%= review.replyAuthor[i] %>
                                                                                                ：
                                                                                                <%= review.reply[i] %>
                                                                                        </p>
                                                                                        <% } %>
                                                                            </div>
                                                                            <% } %>
                                                                                <a href="/reply/<%= review._id %>?post=<%= campground._id %>"
                                                                                    class="btn replybtn m-0">REPLY</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <% } %>
                                                                    <% } %>
                                </div>
                        </div>
            </div>
        </div>





        <script>
            const campground = <% - JSON.stringify(campground) %>;
        </script>